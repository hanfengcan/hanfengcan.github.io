<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>阿里IOT快速上手 | 代码杂货店</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.f40fe9bd.css" as="style"><link rel="preload" href="/assets/js/app.7f2137d4.js" as="script"><link rel="preload" href="/assets/js/5.d7360eb2.js" as="script"><link rel="prefetch" href="/assets/js/2.5bada26e.js"><link rel="prefetch" href="/assets/js/3.4cb54c3a.js"><link rel="prefetch" href="/assets/js/4.d8319661.js"><link rel="prefetch" href="/assets/js/6.98d7c79c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f40fe9bd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">代码杂货店</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">首页</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>nodemcu</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vscode扩展</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>阿里IOT</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/article/阿里IOT/阿里IOT快速上手.html" class="active sidebar-link">阿里IOT快速上手</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/article/阿里IOT/阿里IOT快速上手.html#初识alios-things" class="sidebar-link">初识AliOS Things</a></li><li class="sidebar-sub-header"><a href="/article/阿里IOT/阿里IOT快速上手.html#安装插件" class="sidebar-link">安装插件</a></li><li class="sidebar-sub-header"><a href="/article/阿里IOT/阿里IOT快速上手.html#第一个工程" class="sidebar-link">第一个工程</a></li><li class="sidebar-sub-header"><a href="/article/阿里IOT/阿里IOT快速上手.html#题外话" class="sidebar-link">题外话</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="阿里iot快速上手"><a href="#阿里iot快速上手" aria-hidden="true" class="header-anchor">#</a> 阿里IOT快速上手</h1> <p></p><div class="table-of-contents"><ul><li><a href="#初识alios-things">初识AliOS Things</a></li><li><a href="#安装插件">安装插件</a><ul><li><a href="#python-2">python 2</a></li><li><a href="#python-3">python 3</a></li></ul></li><li><a href="#第一个工程">第一个工程</a><ul><li><a href="#编译完成">编译完成</a></li><li><a href="#刷入固件">刷入固件</a></li><li><a href="#最终效果">最终效果</a></li></ul></li><li><a href="#题外话">题外话</a></li></ul></div><p></p> <h2 id="初识alios-things"><a href="#初识alios-things" aria-hidden="true" class="header-anchor">#</a> 初识AliOS Things</h2> <p><a href="http://aliosthings.io/#/zh-cn/" target="_blank" rel="noopener noreferrer">AliOS Things<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是AliOS去年（2017）发布的物联网操作系统。经过一年的发展，配套的开发环境相对成熟。本文准备简单的介绍在Windows环境下，将alios-things刷入esp32。</p> <p>开始之前，需要准备几样东西：</p> <ul><li>vs code</li> <li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.cpptools" target="_blank" rel="noopener noreferrer">C/C++<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件</li> <li><a href="https://marketplace.visualstudio.com/items?itemName=alios.alios-studio" target="_blank" rel="noopener noreferrer">alios-studio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>插件</li></ul> <p>alios-studio是一个vscode插件，方便使用vscode开发alios-studio应用。由于是C语言，所以还需要C/C++插件支持。</p> <h2 id="安装插件"><a href="#安装插件" aria-hidden="true" class="header-anchor">#</a> 安装插件</h2> <p>alios-studio插件还属于快速迭代阶段，安装插件可能需要折腾一下。当然，过程不会很难。如果你的电脑没有安装过python的，则会相对顺利一些。</p> <p>如果你电脑里有python2和python3也没关系，文章会给出解决办法。</p> <h3 id="python-2"><a href="#python-2" aria-hidden="true" class="header-anchor">#</a> python 2</h3> <p>这里先假设你的电脑没有安装过python。</p> <p>由于使用到一个基于py2开发的工具，所以需要先安装<a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener noreferrer">python2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。必须是python2，因为有些工具不支持python3。</p> <p>另外，还需要git的客户端。</p> <p>安装好这两个后，记得设置系统路径。确保可以使用命令行使用py2和git。</p> <p>接着在vs code的扩展里安装C/C++和alios-stuido。</p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-36997cc3edf04f01.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="C/C++"></p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-7ef40c84e04b86c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="alios-stuido"></p> <p>安装完alios-studio后，插件会提示是否安装aos。点击YES，让插件帮忙安装aos。如果安装成功了，则会在用户目录下产生一个.aos的文件夹<code>C:\Users\lenovo\.aos</code>，类似于这样子的的目录结构：</p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-1d2eabda08340fb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=".aos"></p> <p>目录<code>python-venv</code>是py2的虚拟环境，所有aos相关的工具都在目录<code>.aos\python-venv\Scripts</code>下。</p> <p>到这里，安装基本完成。</p> <h3 id="python-3"><a href="#python-3" aria-hidden="true" class="header-anchor">#</a> python 3</h3> <p>如果你的电脑里面既有py2又有py3。如果你只是将py3配入系统路径，又不想将py2也配入系统路径，那么，建议手动安装aos-cube。</p> <p>安装需要virtualenv来创建虚拟环境，可以使用<code>virtualenv -p D:\Python27\python.exe xxx\.aos\python-venv</code>来指定py版本。注意路径。</p> <p>打开cmd或者cmder执行script目录下面有个activate.bat文件启动py2的虚拟环境。然后安装aos-cube</p> <p><code>pip install aos-cube</code></p> <p>安装后，打开vscode。如果插件不会提示安装aos-cube，则说明安装完成。</p> <h2 id="第一个工程"><a href="#第一个工程" aria-hidden="true" class="header-anchor">#</a> 第一个工程</h2> <p>下载alios-things的最新源码<code>git clone https://github.com/alibaba/AliOS-Things.git</code>。仓库比较大，不建议放C盘。也不要使用alios-things studio的create功能创建工程，不然会clone仓库到C盘。</p> <p>在vs code打开源码，可以看到下面的工具条。</p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-02efdc806fd5008b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p> <p>点击放大镜处，选择以esp32作为编译目标的helloworld例子。</p> <p>点击√来编译源码，第一次编译会下载对应的gcc。</p> <h3 id="编译完成"><a href="#编译完成" aria-hidden="true" class="header-anchor">#</a> 编译完成</h3> <p>如果一切顺利的话，你可以看到类似于下图一样的结果。</p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-f73c52b3cc463a06.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="编译完成"></p> <h3 id="刷入固件"><a href="#刷入固件" aria-hidden="true" class="header-anchor">#</a> 刷入固件</h3> <p>写本文的时候，插件的update功能似乎还存在bug。使用的时候提示esptool.py不存在，因为Windows下面是esptool.exe。</p> <p>一样的，现在cmd或者cmder中启用py2的虚拟环境，然后执行下面的代码。注意路径。</p> <div class="language- extra-class"><pre class="language-text"><code>esptool --chip esp32 --port COM3 --baud 921600 --before default_reset --after hard_reset write_flash -z --flash_mode dio --flash_freq 40m --flash_size detect 0x1000 F:\alios-things\AliOS-Things/platform/mcu/esp32/bsp/bootloader.bin 0x8000 F:\alios-things\AliOS-Things/platform/mcu/esp32/bsp/custom_partitions.bin 0x10000 F:\alios-things\AliOS-Things/out/helloworld@esp32devkitc/binary/helloworld@esp32devkitc.bin
</code></pre></div><p>重新排版一下看esptool的option，应该很好理解的。</p> <div class="language-c extra-class"><pre class="language-c"><code>esptool 
  <span class="token operator">--</span>chip esp32
  <span class="token operator">--</span>port COM3
  <span class="token operator">--</span>baud <span class="token number">921600</span> 
  <span class="token operator">--</span>before default_reset 
  <span class="token operator">--</span>after hard_reset write_flash <span class="token operator">-</span>z 
  <span class="token operator">--</span>flash_mode dio 
  <span class="token operator">--</span>flash_freq <span class="token number">40</span>m 
  <span class="token operator">--</span>flash_size detect 
    <span class="token number">0x1000</span> <span class="token punctuation">.</span><span class="token operator">/</span>platform<span class="token operator">/</span>mcu<span class="token operator">/</span>esp32<span class="token operator">/</span>bsp<span class="token operator">/</span>bootloader<span class="token punctuation">.</span>bin 
    <span class="token number">0x8000</span> <span class="token punctuation">.</span><span class="token operator">/</span>platform<span class="token operator">/</span>mcu<span class="token operator">/</span>esp32<span class="token operator">/</span>bsp<span class="token operator">/</span>custom_partitions<span class="token punctuation">.</span>bin 
    <span class="token number">0x10000</span> <span class="token punctuation">.</span><span class="token operator">/</span>out<span class="token operator">/</span>helloworld@esp32devkitc<span class="token operator">/</span>binary<span class="token operator">/</span>helloworld@esp32devkitc<span class="token punctuation">.</span>bin
</code></pre></div><h3 id="最终效果"><a href="#最终效果" aria-hidden="true" class="header-anchor">#</a> 最终效果</h3> <p>刷入固件后，可以使用<code>aos monitor COM3 115200</code>来查看esp32是否正常工作。</p> <p><img src="https://upload-images.jianshu.io/upload_images/3379069-b739282f6d283a21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/720" alt="hello world"></p> <p>更多aos命令可以查看<code>/.vscode/task.json</code>。</p> <h2 id="题外话"><a href="#题外话" aria-hidden="true" class="header-anchor">#</a> 题外话</h2> <p>alios-studio这个vscode插件还没有做到完全开箱即用。因为涉及依赖比较多，增加了上手alios-things的门槛。我一开始安装这个插件的时候也遇到困难，多亏插件开发者帮助才用上alios-studio。如果你在安装过程中遇到困，不妨到<a href="https://github.com/alibaba/AliOS-Things/issues" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上面找答案。</p> <p>后面有空还会介绍如何使用JavaScript开发阿里IOT。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/5.d7360eb2.js" defer></script><script src="/assets/js/app.7f2137d4.js" defer></script>
  </body>
</html>
